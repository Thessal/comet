# Comet Language Specification

Comet is a domain-specific functional language for defining **Semantic Logical Flows** in quantitative finance.

## Design Philosophy

-   **Types**: Concepts can be **Represented** by Concrete ADTs (`Series`, `DataFrame`).
-   **Properties**: Concepts can be **Qualified** by **Type Classes** (`Volume`, `NonZero`, `Stationary`).
-   **Synthesis**: Operations are generated by resolving valid **Type Class Instances**.

## 1. Concrete Data Types (ADTs)

Comet supports a minimal set of concrete containers for `Real` (Float) and `Int`.

```clean
// Data Atoms
:: Real = Real // Native 64-bit Float
:: Int  = Int  // Native 64-bit Integer

// Data Containers
:: Constant a  = Constant a             // Scalar value
:: Series a    = Series (Array Int a)   // Time-series (1D)
:: DataFrame a = DataFrame (Array Int (Array Int a)) // Tabular (2D)
:: Matrix a    = Matrix (Array Int a (Array Int (Array Int a)))    // Tensor (3D)
```

## 2. Semantic Types (Synonyms)

Domain concepts are synonyms for these concrete types, usually with attached Instances.

```clean
:: Volume :== Series Real
:: Price  :== Series Real
:: Return :== Series Real
```

## 3. Properties (Type Classes)

Properties are explicitly defined as classes.

```clean
class NonZero a
class Stationary a
class Monetary a
```

## 4. Behaviors (Classes) & Logic (Instances)

Behaviors are Multi-Parameter Type Classes.

```clean
class Comparator a b c :: a b -> c

// Instance: Ratio (Specific Logic)
instance Comparator Volume Volume Series | NonZero b & SameRepresentation a b
    where compare a b = a / b
```

## 5. Flows (Functions)

Flows are functions.

```clean
strategy :: Volume Volume -> Signal
strategy v1 v2 = 
    let cmp = compare v1 v2 
    in  trigger cmp
```

## 6. Constraints (Where/Ensures)

| Concept | Implementation | Example |
| :--- | :--- | :--- |
| **Where** | **Class Constraints** | `instance ... | NonZero x` |
| **Ensures** | **Newtype Wrappers** | `-> Stationary Result` |

### Ensures Wrapper
```clean
:: Stationary a = Stationary a
instance Stationary (Stationary a)
```
